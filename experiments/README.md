# Experimentation Setup

## Measurements
The `measurements` folder contains data collected from various measurement methods applied to different debloating tools for each System Under Test (SUT).

- **Energibridge**: This directory includes CSV files for each experiment, along with a Jupyter Notebook to process the collected data.

## Systems Under Test (SUT)
The `SUT` folder contains built artifacts (fat JARs including all necessary dependencies) generated after applying different debloating tools to the SUT.

### Included Libraries:
- **JGit**: A Java library enabling Git operations.
- **ZXing**: A high-performance library for working with QR and barcode operations.

### Folder Structure
Each library within the `SUT` directory contains the following files and subdirectories:

- **root-directory**: Contains configuration files, such as `proguard.pro` and `pom.xml`, for tools requiring Maven-based setup. This directory also includes other files and folders required by the debloating tools, but these can generally be ignored unless you're configuring the tools.

- **artifacts**: Contains the generated JAR files. The `vanilla` artifact refers to the original version of the JAR, without any debloating applied. This directory also includes:
  - **jlink-runtime**: The resulting artifact from running JLink on the project for Java runtime customization.
  - **Proguard mapping**: If obfuscation is used, this folder will contain the Proguard mapping file, which maps obfuscated names back to their original names for debugging.

- **src**: Contains the source code that utilizes the library. This is where the program that uses the debloated library is located.

### Reproducing the experiments:
- **Original artifact**: Use the original pom file to build the artifact
`mvn clean install`

- **Deptrim**: Use the specialized pom file that is generated by pom-deptrim.xml to build the artifact
`mvn -f pom-deptrim-specialized.xml clean install`
This pom file also uses libs-specialized (debloated libraries), which was generated at the same time.

- **Depclean**: Use the debloated pom file to build the artifact
`mvn -f pom-depclean.xml clean install`
Alternatively, generate pom-debloated.xml yourself and then use this pom file to build with the same result:
`mvn se.kth.castor:depclean-maven-plugin:2.0.6:depclean -DcreatePomDebloated=true`

- **Proguard**: Use the proguard setup file to debloat the original artifact
`java -jar full/path/to/proguard.jar @full/path/to/proguard.pro`
Ensure that the original artifact was built before executing this command to not mix debloating tools.

- **JLink**: Use jdeps to list all the necessary dependencies
`jdeps --ignore-missing-deps --list-deps full/path/to/jar`

Then add the listed java modules to the jlink command and run it to create the jlink artifact:
`jlink --compress=2 --strip-debug --no-header-files --no-man-pages --add-modules identified-modules-here --output jlink-runtime`

Use the resulting artifact to run the vanilla jar file:
`.artifacts/jlink-runtime/bin/java.exe -jar path/to/vanilla.jar`
It can be used for any of the artifact jar files for the same project, but in the experiments it was only used on the vanilla version.

- **Energibridge:**
Run the measurements. Result.csv will be outputted next to where you ran the command after the program finishes. 
`./energibridge.exe -o result.csv java -jar full/path/to/jar`