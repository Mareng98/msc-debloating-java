# Experimentation Setup

## Measurements

The `measurements` directory contains energy and performance data collected using [Energibridge](https://github.com/greensoftwarelab/Energibridge) for each debloating tool applied to the various Systems Under Test (SUTs). It also includes a Jupyter Notebook to process and analyze the collected results.

- **results/** – Contains CSV files for each trial's output metrics (energy, CPU, memory, etc.).
- **noise/** – Contains CSV files for noise measurements recorded after each trial.

## Systems Under Test (SUTs)

The `benchmarks/` and `real_world_programs/` folders contain built artifacts (fat JARs) of SUTs after applying each debloating tool. Each project includes the original version (`vanilla`) as well as debloated versions.

### Folder Structure

Each SUT project directory typically includes the following:

- **root-directory/**  
  Contains configuration files used by the debloating tools (e.g., `proguard.pro`, `pom.xml`, etc.). These may be edited to adjust tool behavior but can usually be left as-is.

- **artifacts/**  
  Contains generated JAR files:
  - `vanilla.jar`: the original, non-debloated version.
  - `jlink-runtime/`: the output directory from applying JLink.

- **src/**  
  Contains source code used to exercise the library/application during testing.

- **debloating_output.txt**  
  Captures console output from debloating tool execution.

---

## Reproducing the Experiments

Below are the instructions to rebuild or regenerate artifacts for each debloating tool.
- **Original artifact**: Use the original pom file to build the artifact
`mvn clean install`

- **Deptrim**: Use the specialized pom file that is generated by pom-deptrim.xml to build the artifact
`mvn -f pom-deptrim-specialized.xml clean install`
This pom file also uses libs-specialized (debloated libraries), which was generated at the same time.

- **Depclean**: Use the debloated pom file to build the artifact
`mvn -f pom-depclean.xml clean install`
Alternatively, generate pom-debloated.xml yourself and then use this pom file to build with the same result:
`mvn se.kth.castor:depclean-maven-plugin:2.0.6:depclean -DcreatePomDebloated=true`

- **Proguard**: Use the proguard setup file to debloat the original artifact
`java -jar full/path/to/proguard.jar @full/path/to/proguard.pro`
Ensure that the original artifact was built before executing this command to not mix debloating tools.

- **JLink**: Use jdeps to list all the necessary dependencies
`jdeps --ignore-missing-deps --list-deps full/path/to/jar` Then add the listed java modules to the jlink command and run it to create the jlink artifact:
`jlink --compress=2 --strip-debug --no-header-files --no-man-pages --add-modules identified-modules-here --output jlink-runtime` Use the resulting artifact to run the vanilla jar file:
`artifacts/jlink-runtime/bin/java.exe -jar path/to/vanilla.jar` It can be used for any of the artifact jar files for the same project, but in the experiments it was only used on the vanilla version.

- **Note**: There are some additional instructions located in the readme files of each SUT if different steps are needed to be done to build the artifacts.

- **Energibridge:**
Run the measurements either manually with the following command:
`./energibridge.exe -i 1000 -o result.csv java -jar full/path/to/jar`
or automatically with `./run_experiment.sh`, provided all of the necessary setup is performed (pay special attention to the hardcoded file paths).
